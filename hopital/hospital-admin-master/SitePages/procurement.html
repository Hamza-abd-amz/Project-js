<html>
<head>
<title>Admin

</title>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="../SiteAssets/css/vendors/bootstrap.min.css"/>
<link rel="stylesheet" href="../SiteAssets/css/vendors/line-awesome.min.css"/>
<link rel="stylesheet" href="../SiteAssets/css/pages/layout.css"/>
<link rel="icon" href="../../doclab-master/favicon.svg"/>
<script src="../SiteAssets/js/vendors/jquery.min.js">

</script>
<script src="../SiteAssets/js/vendors/bootstrap.bundle.min.js">

</script>
<script src="../SiteAssets/js/global.js">

</script>
<link rel="stylesheet" href="../SiteAssets/css/pages/procurement.css"/></head><body>
  <!-- Header Section -->
  <header>
    <nav class="navbar navbar-expand-lg shadow-sm fixed-top">
      <a class="navbar-brand" href="">
        <img src="../../doclab-master/favicon.svg" alt="Doclab Logo"/>
        <span>Doclab</span>
      </a>
      <div class="navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="las la-question-circle"></i>
            </a>
          </li>
          <li class="nav-item dropdown dropleft">
            <a class="nav-link notification-dropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="badge badge-pill badge-primary" style="float:right;margin-bottom:-10px;">3</span>
              <i class="las la-bell"></i>
            </a>
            <div class="dropdown-menu notification-dropdown-menu shadow-lg" aria-labelledby="notification-dropdown">
              <div class="dropdown-title">
                <a href="#">Notifications <span class="ml-2 notifications-count">(3)</span></a>
                <a class="float-right" href="#">Mark all as read</a>
              </div>
              <div class="dropdown-body">
                <ul class="list-unstyled">
                  <li class="media">
                    <a class="notification-card" href="#">
                      <img class="mr-3" src="../SiteAssets/images/inbox.svg" alt="Notification Icon"/>
                      <div class="media-body">
                        <h6 class="mt-0 mb-1">Collaboration tools available</h6>
                        <p>Cras sit amet nibh libero, in gravida nulla.</p>
                        <small class="text-muted">21.03.2020, 13:02</small>
                      </div>
                    </a>
                  </li>
                  <!-- Repeat Notification Items as Needed -->
                </ul>
              </div>
              
            </div>
          </li>
          <li class="nav-item">
            <div class="nav-link">
              <span class="vertical-divider"></span>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link profile-dropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <img class="rounded-circle" src="./admin.png" alt="Profile Picture"/>
              <span class="d">Redoooxx</span>
            </a>
            <div class="dropdown">
              <div class="dropdown-menu shadow-lg profile-dropdown-menu" aria-labelledby="profile-dropdown">
                <a class="dropdown-item" href="#">
                  <i class="las la-user mr-2"></i>Profile
                </a>
                <a class="dropdown-item" href="#">
                  <i class="las la-cog mr-2"></i>Settings
                </a>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  
  <!-- Main Content Section -->
  <main>
    <div class="side-nav">
      <ul class="list-group list-group-flush">
        <a class="list-group-item" href="dashboard.html" data-toggle="tooltip" data-placement="bottom" title="Dashboard">
          <i class="las la-shapes la-lw"></i>
          <span>Dashboard</span>
        </a>
        <a class="list-group-item" href="patients.html" data-toggle="tooltip" data-placement="bottom" title="Patients">
          <i class="las la-user-injured la-lw"></i>
          <span>Patients</span>
        </a>
        <a class="list-group-item" href="specialists.html" data-toggle="tooltip" data-placement="bottom" title="Specialists">
          <i class="las la-clinic-medical la-lw"></i>
          <span>Specialists</span>
        </a>
        <a class="list-group-item active" href="procurement.html" data-toggle="tooltip" data-placement="bottom" title="Procurement">
          <i class="las la-shopping-cart la-lw"></i>
          <span>Procurement</span>
        </a>
        <a class="list-group-item" href="notifications.html" data-toggle="tooltip" data-placement="bottom" title="Staff">
          <i class="las la-sms la-lw"></i>
          <span>Staff</span>
        </a>

      </ul>
    </div>
<div class="main-content">
<div class="container-fluid">
<div class="section title-section">
<div class="row">
<div class="col-md-6">
<h5 class="page-title">

</h5></div>
<div class="col-md-6">
<button class="btn btn-dark-red-f-gr">
<i class="las la-plus-circle">

</i>create a request</button></div></div></div>
<div class="section filters-section">
<div class="row">
<div class="col-lg-8 col-md-6">
<button class="btn btn-dark-red-o mr-2">
<i class="las la-filter">

</i>filter</button>
<button class="btn btn-dark-red-o">
<i class="las la-sort">

</i>sort</button></div>
<div class="col-lg-4 col-md-6">
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">
<i class="las la-search">

</i></span></div>
<input class="form-control" placeholder="search by title, owner, or vendor"/></div></div></div></div>
<div class="section content-section">
<table class="table table-hover table-responsive-lg">
<thead>
<tr>
<th>inquiries

</th>
<th>items

</th>
<th>date created

</th>
<th>created by

</th>
<th>status

</th>
<th>

</th></tr></thead>
<tbody></tbody></table></div>
<div class="modal onboarding-modal" tabindex="=1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Welcome

</h5>
<button class="close" type="button" data-dismiss="modal" aria-label="Close">
<i class="las la-times-circle">

</i></button></div>
<div class="modal-body">
<div class="carousel slide" id="carouselExampleCaptions" data-ride="carousel">
<div class="carousel-inner">
<div class="carousel-item active">
<img class="d-block" src="../SiteAssets/images/undraw_dashboard_nklg.svg" alt="..."/>
<div class="carousel-caption d-md-block">
<p>intuitive
<a href="" data-dismiss="modal">dashboard
<i class="las la-external-link-alt">

</i></a></p></div></div>
<div class="carousel-item">
<img class="d-block" src="../SiteAssets/images/undraw_medicine_b1ol.svg" alt="..."/>
<div class="carousel-caption d-md-block">
<p>access to
<a href="specialists.html">specialists
<i class="las la-external-link-alt">

</i></a></p></div></div>
<div class="carousel-item">
<img class="d-block" src="../SiteAssets/images/undraw_receipt_ecdd.svg" alt="..."/>
<div class="carousel-caption d-md-block">
<p>simple
<a href="procurement.html">procurement
<i class="las la-external-link-alt">

</i></a>process</p></div></div>
<div class="carousel-item">
<img class="d-block" src="../SiteAssets/images/undraw_new_notifications_fhvw.svg" alt="..."/>
<div class="carousel-caption d-md-block">
<p>comprehensive
<a href="notifications.html">notification
<i class="las la-external-link-alt">

</i></a>center</p></div></div>
<div class="carousel-item">
<img class="d-block" src="../SiteAssets/images/undraw_Preferences_re_49in.svg" alt="..."/>
<div class="carousel-caption d-md-block">
<p>minimalist
<a href="settings.html">settings
<i class="las la-external-link-alt">

</i></a>center</p></div></div></div>
<a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
<i class="las la-chevron-circle-left">

</i>
<span class="sr-only">Previous

</span></a>
<a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
<i class="las la-chevron-circle-right">

</i>
<span class="sr-only">Next

</span></a></div></div></div></div></div></div>
<footer>
<div class="page-footer text-center">
<div class="fixed-bottom shadow-sm">
<a href="https://covid19.who.int" target="_blank">
<img src="../SiteAssets/images/covid-19.svg"/>
<span>view COVID-19 info

</span></a></div></div></footer></div></main></body></html>
<script>
let db;
const DB_NAME = 'ProcurementDB';
const STORE_NAME = 'procurements';

// Initialize IndexedDB
const request = indexedDB.open(DB_NAME, 1);

request.onerror = (event) => {
  console.error("Database error:", event.target.error);
};

request.onupgradeneeded = (event) => {
  db = event.target.result;
  if (!db.objectStoreNames.contains(STORE_NAME)) {
    const store = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
    store.createIndex('title', 'title', { unique: false });
  }
};

request.onsuccess = (event) => {
  db = event.target.result;
  loadProcurements();
};

function addProcurement(procurement) {
  const transaction = db.transaction([STORE_NAME], 'readwrite');
  const store = transaction.objectStore(STORE_NAME);
  store.add(procurement);
  loadProcurements();
}

function editProcurement(id, updatedProcurement) {
  const transaction = db.transaction([STORE_NAME], 'readwrite');
  const store = transaction.objectStore(STORE_NAME);
  updatedProcurement.id = id;
  store.put(updatedProcurement);
  loadProcurements();
}

function deleteProcurement(id) {
  const transaction = db.transaction([STORE_NAME], 'readwrite');
  const store = transaction.objectStore(STORE_NAME);
  store.delete(id);
  loadProcurements();
}

function loadProcurements() {
  const tbody = document.querySelector('tbody');
  tbody.innerHTML = '';
  
  const transaction = db.transaction([STORE_NAME], 'readonly');
  const store = transaction.objectStore(STORE_NAME);
  const request = store.openCursor();
  
  request.onsuccess = (event) => {
    const cursor = event.target.result;
    if (cursor) {
      const row = `
        <tr>
          <td>
            <p>${cursor.value.title}</p>
            <small class="text-muted">${cursor.value.code}</small>
          </td>
          <td>${cursor.value.items}</td>
          <td>${cursor.value.date}</td>
          <td>${cursor.value.creator}</td>
          <td>
            <label class="label-blue label-md">${cursor.value.status}</label>
          </td>
          <td>
            <button onclick="editProcurement(${cursor.value.id})" class="btn btn-sm">
              <i class="las la-edit"></i>
            </button>
            <button onclick="deleteProcurement(${cursor.value.id})" class="btn btn-sm">
              <i class="las la-trash"></i>
            </button>
          </td>
        </tr>`;
      tbody.insertAdjacentHTML('beforeend', row);
      cursor.continue();
    }
  };
}
</script>
<!-- Add Request Modal -->
<div class="modal fade" id="addRequestModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create New Request</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="requestForm">
          <div class="form-group">
            <label>Title</label>
            <input type="text" class="form-control" id="title" required>
          </div>
          <div class="form-group">
            <label>Code</label>
            <input type="text" class="form-control" id="code" required>
          </div>
          <div class="form-group">
            <label>Items Quantity</label>
            <input type="number" class="form-control" id="items" required>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-control" id="status">
              <option>pending</option>
              <option>ongoing</option>
              <option>outgoing</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveRequest()">Save Request</button>
      </div>
    </div>
  </div>
</div>

<script>
// Show modal when create request button is clicked
document.querySelector('.btn-dark-red-f-gr').addEventListener('click', () => {
  $('#addRequestModal').modal('show');
});

function saveRequest() {
  const procurement = {
    title: document.getElementById('title').value,
    code: document.getElementById('code').value,
    items: document.getElementById('items').value,
    date: new Date().toLocaleDateString(),
    creator: 'Redoooxx',  // Would normally come from logged in user
    status: document.getElementById('status').value
  };

  addProcurement(procurement);
  $('#addRequestModal').modal('hide');
  document.getElementById('requestForm').reset();
}

function editProcurement(id) {
  // Get the procurement details and populate modal
  const transaction = db.transaction([STORE_NAME], 'readonly');
  const store = transaction.objectStore(STORE_NAME);
  const request = store.get(id);

  request.onsuccess = () => {
    const procurement = request.result;
    document.getElementById('title').value = procurement.title;
    document.getElementById('code').value = procurement.code;
    document.getElementById('items').value = procurement.items;
    document.getElementById('status').value = procurement.status;

    $('#addRequestModal').modal('show');

    // Override save button to update instead of add
    document.querySelector('.modal-footer .btn-primary').onclick = () => {
      const updatedProcurement = {
        title: document.getElementById('title').value,
        code: document.getElementById('code').value,
        items: document.getElementById('items').value,
        date: procurement.date,
        creator: procurement.creator,
        status: document.getElementById('status').value
      };
      
      updateProcurement(id, updatedProcurement);
      $('#addRequestModal').modal('hide');
      document.getElementById('requestForm').reset();
    };
  };
}

function updateProcurement(id, updatedProcurement) {
  const transaction = db.transaction([STORE_NAME], 'readwrite');
  const store = transaction.objectStore(STORE_NAME);
  updatedProcurement.id = id;
  store.put(updatedProcurement);
  loadProcurements();
}

function deleteProcurement(id) {
  if(confirm('Are you sure you want to delete this request?')) {
    const transaction = db.transaction([STORE_NAME], 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    store.delete(id);
    loadProcurements();
  }
}
</script></div>